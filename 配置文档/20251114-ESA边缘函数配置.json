{
  "version": "2025-10-15",
  "functions": [
    {
      "name": "fortunepacific-admin-bypass",
      "route_expression": "(lower(http.request.uri.path) eq \"/manage\") or (lower(http.request.uri.path) eq \"/admin\")",
      "code": "export default { async fetch(request) { const url = new URL(request.url); const hostname = url.hostname;\n// 域名过滤\nif (hostname !== 'www.fortunepacific.net' && hostname !== 'fortunepacific.net') {\n  return fetch(request);\n}\n\n// 管理路径强制直接回源，完全不缓存\nconst newRequest = new Request(request);\nnewRequest.headers.set('X-Edge-Bypass', 'admin-area');\nnewRequest.headers.set('Cache-Control', 'no-cache');\nconst response = await fetch(newRequest);\n// 设置响应头确保不缓存\nconst newHeaders = new Headers(response.headers);\nnewHeaders.set('Cache-Control', 'no-cache, no-store, must-revalidate, max-age=0');\nnewHeaders.set('Pragma', 'no-cache');\nnewHeaders.set('Expires', '0');\nnewHeaders.set('X-Edge-Function', 'admin-bypass');\nreturn new Response(response.body, {\n  status: response.status,\n  statusText: response.statusText,\n  headers: newHeaders\n});\n} };"
    },
    {
      "name": "fortunepacific-main-site",
      "route_expression": "(not lower(http.request.uri.path) in {\"/manage\" \"/admin\"} and not lower(http.request.uri.path.extension) in {\"css\" \"js\" \"jpg\" \"jpeg\" \"png\" \"gif\" \"svg\" \"ico\" \"webp\" \"json\" \"xml\" \"pdf\" \"woff\" \"ttf\" \"eot\" \"mp4\" \"avi\" \"mov\" \"zip\" \"rar\" \"7z\"})",
      "code": "export default { async fetch(request) { const url = new URL(request.url); const hostname = url.hostname;\n// 只处理主域名\nif (hostname !== 'www.fortunepacific.net' && hostname !== 'fortunepacific.net') {\n  return fetch(request);\n}\ntry {\n  const response = await fetch(request);\n  // 只处理HTML内容\n  const contentType = response.headers.get('content-type') || '';\n  if (!contentType.includes('text/html') || response.status !== 200) {\n    return response;\n  }\n  const responseClone = response.clone();\n  let html = await responseClone.text();\n  // 安全检查：避免重复处理\n  if (html.includes('GTM-5GJ3FS9')) {\n    return response;\n  }\n  // ==================== SEO优化注入 ====================\n  const seoCode = `\n  <!-- Google Tag Manager -->\n  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':\n  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],\n  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=\n  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);\n  })(window,document,'script','dataLayer','GTM-5GJ3FS9');</script>\n  <!-- Search Engine Verification -->\n  <meta name=\"msvalidate.01\" content=\"4316C9E5FB815368E618ED003BF90DDF\" />\n  <meta name=\"yandex-verification\" content=\"0c90bbde613f95ce\" />\n  <meta name=\"google-site-verification\" content=\"Dz5PFOFJVuxC-AouUMiMgixdtcPfrPAfEBt6fBlqmHI\" />\n  <!-- Multi-language Hreflang -->\n  <link rel=\"alternate\" hreflang=\"x-default\" href=\"https://www.fortunepacific.net/\" />\n  <link rel=\"alternate\" hreflang=\"en\" href=\"https://www.fortunepacific.net/\" />\n  <!-- Structured Data -->\n  <script type=\"application/ld+json\">\n  {\n    \"@context\": \"https://schema.org\",\n    \"@type\": \"Organization\",\n    \"name\": \"FORTUNE PACIFIC LIMITED\",\n    \"url\": \"https://www.fortunepacific.net/\",\n    \"logo\": \"https://www.fortunepacific.net/logo.png\",\n    \"address\": {\n      \"@type\": \"PostalAddress\",\n      \"streetAddress\": \"SUITE 108 CHASE BUSINESS CENTRE 39-41 CHASE SIDE\",\n      \"addressLocality\": \"LONDON\",\n      \"postalCode\": \"N14 5BP\",\n      \"addressCountry\": \"UK\"\n    }\n  }\n  </script>\n  `;\n  const bodyCode = `\n  <!-- Google Tag Manager (noscript) -->\n  <noscript><iframe src=\"https://www.googletagmanager.com/ns.html?id=GTM-5GJ3FS9\"\n  height=\"0\" width=\"0\" style=\"display:none;visibility:hidden\"></iframe></noscript>\n  `;\n  // 注入代码\n  html = html.replace('</head>', `${seoCode}</head>`);\n  html = html.replace(/<body[^>]*>/, `$&${bodyCode}`);\n  // ==================== 响应头优化 ====================\n  const newHeaders = new Headers(response.headers);\n  newHeaders.set('Cache-Control', 'public, max-age=300'); // 5分钟缓存\n  newHeaders.set('X-Edge-Function', 'main-site-optimized');\n  newHeaders.delete('content-length');\n  return new Response(html, {\n    status: response.status,\n    statusText: response.statusText,\n    headers: newHeaders\n  });\n} catch (error) {\n  return fetch(request);\n}\n} };"
    }
  ]
}
